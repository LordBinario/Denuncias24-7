DELIMITER $$ 
CREATE PROCEDURE REGISTRO
(
    ANONIMO TEXT,
    CORREO TEXT, 
    CONTRASEÑA TEXT,
    DEPTO INT
)
BEGIN
	DECLARE ID_USUARIO INT DEFAULT 0;
    
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
    	ROLLBACK;
        SHOW ERRORS LIMIT 1;
    END;

	START TRANSACTION;
    
    INSERT INTO usuario VALUES (NULL, ANONIMO, CORREO, DEPTO);
    SET ID_USUARIO = @@IDENTITY;
    
    INSERT INTO contraseñas VALUES (NULL, (AES_ENCRYPT(CONTRASEÑA, 'D3nvnC!@$*24/7*')), 1, ID_USUARIO);
    
    COMMIT;
END $$;